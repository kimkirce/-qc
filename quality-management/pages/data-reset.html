<div id="data-reset" class="page-content" style="display:none;">
  <div class="page-header">
    <h2>🔄 데이터 초기화</h2>
    <p>시스템 데이터를 초기화합니다. 신중하게 사용하세요!</p>
  </div>

  <div class="content-section">
    <div class="form-container" style="max-width: 800px; margin: 0 auto;">
      <h3>⚠️ 초기화 옵션</h3>
      
      <div class="alert-box" style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
          <span style="font-size: 32px;">⚠️</span>
          <h4 style="color: var(--danger); margin: 0;">주의사항</h4>
        </div>
        <ul style="margin: 10px 0 0 44px; color: var(--text-secondary); line-height: 1.8;">
          <li>초기화된 데이터는 <strong>복구할 수 없습니다</strong></li>
          <li>반드시 <strong>백업</strong>을 먼저 수행하세요</li>
          <li>전체 초기화는 모든 모듈의 데이터를 삭제합니다</li>
          <li>헤더(열 제목)는 유지되고 데이터만 삭제됩니다</li>
        </ul>
      </div>

      <!-- 특정 시트 초기화 -->
      <div style="background: var(--bg-glass); padding: 24px; border-radius: 16px; margin-bottom: 20px;">
        <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>📄</span>
          특정 시트 초기화
        </h4>
        <div class="form-grid">
          <div class="form-group">
            <label>모듈 선택</label>
            <select id="reset-module" style="padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); width: 100%;">
              <option value="">선택하세요</option>
              <option value="TP-101">TP-101 - 공급사평가</option>
              <option value="TP-201">TP-201 - 변경점관리</option>
              <option value="TP-301">TP-301 - 성적서발행</option>
              <option value="TP-401">TP-401 - 도면관리</option>
              <option value="TP-501">TP-501 - 현장관리</option>
              <option value="TP-601">TP-601 - 고객불만</option>
              <option value="TP-701">TP-701 - 공정검사</option>
              <option value="TP-801">TP-801 - 이상동작검출</option>
              <option value="TP-901">TP-901 - 작업표준서</option>
              <option value="TP-1001">TP-1001 - 조립SOP</option>
              <option value="TP-1101">TP-1101 - 검사기준</option>
            </select>
          </div>
          <div class="form-group">
            <label>시트명 입력</label>
            <input type="text" id="reset-sheet" placeholder="예: TP-101-02_공급사평가표" style="padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); width: 100%;">
          </div>
        </div>
        <button onclick="resetSheet()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 16px;">
          시트 초기화
        </button>
      </div>

      <!-- 모듈 전체 초기화 -->
      <div style="background: var(--bg-glass); padding: 24px; border-radius: 16px; margin-bottom: 20px;">
        <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <span>📦</span>
          모듈 전체 초기화
        </h4>
        <div class="form-group">
          <label>모듈 선택</label>
          <select id="reset-module-all" style="padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); width: 100%;">
            <option value="">선택하세요</option>
            <option value="TP-101">TP-101 - 공급사평가 (모든 시트)</option>
            <option value="TP-201">TP-201 - 변경점관리 (모든 시트)</option>
            <option value="TP-301">TP-301 - 성적서발행 (모든 시트)</option>
            <option value="TP-401">TP-401 - 도면관리 (모든 시트)</option>
            <option value="TP-501">TP-501 - 현장관리 (모든 시트)</option>
            <option value="TP-601">TP-601 - 고객불만 (모든 시트)</option>
            <option value="TP-701">TP-701 - 공정검사 (모든 시트)</option>
            <option value="TP-801">TP-801 - 이상동작검출 (모든 시트)</option>
            <option value="TP-901">TP-901 - 작업표준서 (모든 시트)</option>
            <option value="TP-1001">TP-1001 - 조립SOP (모든 시트)</option>
            <option value="TP-1101">TP-1101 - 검사기준 (모든 시트)</option>
          </select>
        </div>
        <button onclick="resetModule()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 16px;">
          모듈 초기화
        </button>
      </div>

      <!-- 전체 시스템 초기화 -->
      <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%); padding: 24px; border-radius: 16px; border: 2px solid var(--danger);">
        <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px; color: var(--danger);">
          <span>🚨</span>
          전체 시스템 초기화
        </h4>
        <p style="color: var(--text-secondary); margin-bottom: 16px;">
          모든 모듈의 모든 데이터가 삭제됩니다. 정말 신중하게 사용하세요!
        </p>
        <div class="form-group">
          <label>확인 문구 입력 (대소문자 구분)</label>
          <input type="text" id="reset-confirm" placeholder="전체삭제" style="padding: 12px; background: var(--bg-secondary); border: 1px solid var(--danger); border-radius: 8px; color: var(--text-primary); width: 100%;">
        </div>
        <button onclick="resetAll()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, var(--danger) 0%, #7f1d1d 100%); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 16px;">
          ⚠️ 전체 초기화 실행
        </button>
      </div>

      <!-- 초기화 이력 -->
      <div style="margin-top: 30px;">
        <h4 style="margin-bottom: 16px;">📜 최근 초기화 이력</h4>
        <div id="reset-history" style="background: var(--bg-glass); padding: 20px; border-radius: 12px; min-height: 100px;">
          <p style="color: var(--text-tertiary); text-align: center;">초기화 이력이 없습니다</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 데이터 초기화 함수들
function showResetMenu() {
  showPage('data-reset');
}

async function resetSheet() {
  const moduleCode = document.getElementById('reset-module').value;
  const sheetName = document.getElementById('reset-sheet').value;
  
  if (!moduleCode || !sheetName) {
    showNotification('모듈과 시트명을 모두 입력하세요', 'warning');
    return;
  }
  
  if (!confirm(`${moduleCode} 모듈의 "${sheetName}" 시트를 초기화하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다!`)) {
    return;
  }
  
  showNotification('초기화 중...', 'info');
  
  try {
    const result = await google.script.run
      .withSuccessHandler(onResetSuccess)
      .withFailureHandler(onResetFailure)
      .clearSheetData(moduleCode, sheetName);
  } catch (error) {
    onResetFailure(error);
  }
}

async function resetModule() {
  const moduleCode = document.getElementById('reset-module-all').value;
  
  if (!moduleCode) {
    showNotification('모듈을 선택하세요', 'warning');
    return;
  }
  
  if (!confirm(`${moduleCode} 모듈의 모든 시트를 초기화하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다!`)) {
    return;
  }
  
  showNotification('초기화 중...', 'info');
  
  try {
    const result = await google.script.run
      .withSuccessHandler(onResetSuccess)
      .withFailureHandler(onResetFailure)
      .clearModuleData(moduleCode);
  } catch (error) {
    onResetFailure(error);
  }
}

async function resetAll() {
  const confirmText = document.getElementById('reset-confirm').value;
  
  if (confirmText !== '전체삭제') {
    showNotification('확인 문구를 정확히 입력하세요', 'danger');
    return;
  }
  
  if (!confirm('⚠️ 경고!\n\n전체 시스템의 모든 데이터가 삭제됩니다.\n이 작업은 되돌릴 수 없습니다!\n\n정말 실행하시겠습니까?')) {
    return;
  }
  
  if (!confirm('마지막 확인입니다.\n\n정말로 모든 데이터를 삭제하시겠습니까?')) {
    return;
  }
  
  showNotification('전체 초기화 중... (시간이 걸릴 수 있습니다)', 'info');
  
  try {
    const result = await google.script.run
      .withSuccessHandler(onResetSuccess)
      .withFailureHandler(onResetFailure)
      .clearAllData();
  } catch (error) {
    onResetFailure(error);
  }
}

function onResetSuccess(result) {
  if (result.success) {
    showNotification(result.message || '초기화가 완료되었습니다', 'success');
    
    // 입력 필드 초기화
    document.getElementById('reset-module').value = '';
    document.getElementById('reset-sheet').value = '';
    document.getElementById('reset-module-all').value = '';
    document.getElementById('reset-confirm').value = '';
    
    // 이력 추가
    addResetHistory(result.message);
    
    // 대시보드 통계 새로고침
    loadDashboardStats();
  } else {
    showNotification(result.message || '초기화 실패', 'danger');
  }
}

function onResetFailure(error) {
  console.error('초기화 에러:', error);
  showNotification('초기화 실패: ' + error.message, 'danger');
}

function addResetHistory(message) {
  const historyDiv = document.getElementById('reset-history');
  const now = new Date().toLocaleString('ko-KR');
  
  const historyItem = document.createElement('div');
  historyItem.style.cssText = 'padding: 12px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;';
  historyItem.innerHTML = `
    <span style="color: var(--text-secondary);">${message}</span>
    <span style="color: var(--text-tertiary); font-size: 12px;">${now}</span>
  `;
  
  if (historyDiv.querySelector('p')) {
    historyDiv.innerHTML = '';
  }
  
  historyDiv.insertBefore(historyItem, historyDiv.firstChild);
  
  // 최대 5개까지만 보관
  while (historyDiv.children.length > 5) {
    historyDiv.removeChild(historyDiv.lastChild);
  }
}
</script>
